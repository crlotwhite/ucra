# OpenUtau Resampler Manifest 가이드 (UCRA 매핑)

이 문서는 UCRA `resampler.json`을 OpenUtau의 Resampler Manifest(YAML)로 변환하는 규칙을 설명합니다.

## 대상 파일

- 입력: UCRA `resampler.json` (schema: `schemas/resampler.schema.json`)
- 출력: OpenUtau Resampler Manifest `*.yaml` (예: `moresampler.yaml`)

## 상단 메타데이터 매핑

- name -> `resampler.name`
- version -> `resampler.version`
- vendor -> `resampler.vendor`
- 실행 파일 경로/이름 -> `resampler.executable` (도구 실행 시 `--exe` 인자로 지정)

## 플래그 매핑

UCRA `flags[]` 각 항목을 OpenUtau `expressions:` 하위 항목으로 변환합니다.

공통 필드:

- key -> 노드 키 및 `abbr`
- desc -> `note` (설명)
- name(없음) -> `key`를 Title Case로 변환해 `name` 채움 (예: `formant_shift` → `Formant Shift`)

타입별 매핑:

- float/int
  - `type: Numerical`
  - `range: [min, max]` -> `min`, `max`
  - `default` -> `default_value`
  - `is_flag: true`, `flag: <key>`
- bool
  - `type: Options`, `min: 0`, `max: 1`
  - `default`(true/false) -> `default_value`(1/0)
  - `options: ['', <key>]`
  - `is_flag: true`
- enum
  - `type: Options`, `min: 0`, `max: 1`, `default_value: 0`
  - `options: ['', '<key>=<value1>', '<key>=<value2>', ...]`
  - `is_flag: true`

주: OpenUtau의 실제 manifest 스펙은 UI/버전에 따라 변할 수 있습니다. 최신 위키의 예시를 참조하세요.

## 예시

입력(`examples/sample-voicebank/resampler.json`) → 출력(`build/openutau_resampler.yaml`)

```yaml
# Auto-generated by UCRA ucra_manifest_gen
resampler:
  name: "UCRA Test Engine"
  executable: "resampler"
  version: "1.0.0"
  vendor: "UCRA Development Team"

expressions:
  brightness:
    name: "Brightness"
    abbr: brightness
    note: "Voice brightness control"
    type: Numerical
    min: 0
    max: 2
    default_value: 1
    is_flag: true
    flag: brightness
  # ...
```

## OpenUtau에 배치

- 출력된 YAML을 OpenUtau의 Resamplers 폴더(플랫폼별 경로 상이)에 배치합니다.
- 파일명은 실행 파일명과 동일(확장자만 `.yaml`)하도록 하는 것이 일반적입니다.

---

## .NET 어댑터/미리보기 캐싱(개요)

이 과업의 후속 단계로, .NET에서 UCRA C API를 래핑하여 OpenUtau에서 스트리밍 프리뷰/캐시를 구현합니다.

- 필수 P/Invoke: `ucra_stream_open`, `ucra_stream_read`, `ucra_stream_close`
- 매개체 구조체 마샬링: `UCRA_RenderConfig`, `UCRA_NoteSegment`
- 캐시 키: `hash(voicebank + segment + flags)` → miss 시 렌더, hit 시 바로 사용

SDK 설치 후 `bindings/dotnet` 디렉터리에 어댑터 클래스를 추가하고 샘플 앱에서 동작을 검증하십시오.
